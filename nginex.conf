events {
    worker_connections 1024;
}

http {
    # Send access logs to stdout
    access_log /dev/stdout main;
    
    # Define a custom log format for access logs
    log_format main '$remote_addr - $request_method $request_uri [$time_local] $status';

    # Send error logs to stdout (or stderr if you prefer)
    error_log /dev/stdout;

    server {
        listen 80;
        server_name localhost;

        # Root location returns Hello World
        location / {
            default_type 'text/plain';
            content_by_lua_block {
                -- Send notification to API
                local http = require "resty.http"
                local httpc = http.new()
                
                local res, err = httpc:request_uri("https://your-api-endpoint.com/notify", {
                    method = "POST",
                    body = '{"message":"Hello World page requested","client_ip":"' .. ngx.var.remote_addr .. '"}',
                    headers = {
                        ["Content-Type"] = "application/json"
                    }
                })
                
                if not res then
                    ngx.log(ngx.ERR, "Failed to send API notification: ", err)
                end
                
                -- Return Hello World to the user
                ngx.say("Hello World from NGINX!")
            }